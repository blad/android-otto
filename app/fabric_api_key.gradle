// TODO: Update to a Cross-Platform Solution
def fabricAPIKeyPlaceholder = 'c0ffeec0ffeec0ffeec0ffeec0ffeec0ffeec0ff'
def fabricAPIKey = System.getenv('FABRIC_API_KEY') ?: fabricAPIKeyPlaceholder

// Tasks To Avoid Committing the Fabric API Key:
task crashlyticPreBuild(type: Exec, description: 'Sets the Fabric API Key') {
    println ':app:crashlyticPreBuild'
    workingDir './'
    commandLine 'bash', '-c', "find . -name  '*.xml' | xargs sed -i '' -e \"s/$fabricAPIKeyPlaceholder/$fabricAPIKey/\""
}

task crashlyticPostBuild(type: Exec, description: 'Resets the Fabric API Key') {
    println ':app:crashlyticPostBuild'
    workingDir './'
    commandLine 'bash', '-c', "find . -name  '*.xml' | xargs sed -i '' -e \"s/$fabricAPIKey/$fabricAPIKeyPlaceholder/\""
}

// Prepare for Build:
preBuild.dependsOn(crashlyticPreBuild)

// Clean-Up:
build.finalizedBy(crashlyticPostBuild)
assemble.finalizedBy(crashlyticPostBuild)
assembleDebug.finalizedBy(crashlyticPostBuild)